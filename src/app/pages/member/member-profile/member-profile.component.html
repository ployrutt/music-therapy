<div class="profile-container">
  <div class="profile-header-card">
    <div class="profile-section">
      <div class="image-wrapper">
        <img
          *ngIf="profileImagePreview || profileImageUrl"
          [src]="profileImagePreview || profileImageUrl"
          class="profile-img"
        />
        <div
          *ngIf="!profileImagePreview && !profileImageUrl"
          class="profile-placeholder"
        >
          <i class="fa-regular fa-circle-user"></i>
        </div>
      </div>
      <div class="action-buttons">
        <input
          type="file"
          #fileInput
          (change)="onFileSelected($event)"
          style="display: none"
        />
        <button
          type="button"
          class="btn btn-upload"
          (click)="fileInput.click()"
        >
          อัปโหลดรูป
        </button>
        <button
          type="button"
          class="btn btn-delete"
          (click)="onRemoveImage()"
          *ngIf="profileImageUrl || profileImagePreview"
        >
          ลบรูป
        </button>
      </div>
    </div>

    <div class="form-container">
      <form [formGroup]="profileForm">
        <div class="form-group">
          <label>ชื่อจริง</label>
          <input type="text" formControlName="first_name" />
        </div>
        <div class="form-group">
          <label>นามสกุล</label>
          <input type="text" formControlName="last_name" />
        </div>
        <div class="form-group">
          <label>เบอร์โทร</label>
          <input type="tel" formControlName="phone_number" />
        </div>
        <div class="button-group">
          <button type="button" class="btn btn-cancel" (click)="onCancel()">
            ยกเลิก
          </button>
          <button type="button" class="btn btn-save" (click)="onSave()">
            บันทึกข้อมูล
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="member-extras" *ngIf="authService.getRole() === 'member'">
    <hr class="divider" />
    <div class="dashboard-grid">
      <!-- <div class="data-column">
        <h3><i class="fa-solid fa-clock-rotate-left"></i> ประวัติการเข้าชม</h3>
        <div class="list-wrapper">
          <div *ngIf="readHistory.length === 0" class="empty-text">ยังไม่มีประวัติการอ่าน</div>
          <div class="list-item row-link" *ngFor="let item of readHistory" (click)="goToActivity(item.activity_id)">
            <div class="info">
              <span class="title">{{ item.activity?.title || item.title || "ไม่มีชื่อกิจกรรม" }}</span>
              <small class="text-muted">อ่านล่าสุด: {{ item.read_at || item.created_at | date: "dd/MM/yyyy HH:mm" }}</small>
            </div>
            <i class="fa-solid fa-chevron-right arrow-icon"></i>
          </div>
        </div>
      </div> -->

      <div class="data-column">
        <h3><i class="fa-solid fa-clock-rotate-left"></i> ประวัติการเข้าชม</h3>
        <div class="list-wrapper">
          <div *ngIf="readHistory.length === 0" class="empty-text">
            ยังไม่มีประวัติการอ่าน
          </div>

          <div
            class="list-item row-link"
            *ngFor="let item of readHistory"
            (click)="goToActivity(item.activity_id)"
          >
            <div class="info">
              <span class="title">{{
                item.activity?.title || "ไม่มีชื่อกิจกรรม"
              }}</span>

              <div class="meta-info">
                <span class="read-badge"
                  >อ่านแล้ว {{ item.read_count }} ครั้ง</span
                >

                <small class="text-muted">
                  ล่าสุดเมื่อ:
                  {{ item.last_read_at | date: "dd/MM/yyyy HH:mm" }}
                </small>
              </div>
            </div>
            <i class="fa-solid fa-chevron-right arrow-icon"></i>
          </div>
        </div>
      </div>

      <div class="data-column">
        <h3><i class="fa-solid fa-heart text-danger"></i> รายการโปรด</h3>
        <div class="list-wrapper">
          <div *ngIf="favorites.length === 0" class="empty-text">
            ยังไม่มีรายการโปรด
          </div>
          <div
            class="list-item row-link"
            *ngFor="let fav of favorites"
            (click)="goToActivity(fav.activity_id)"
          >
            <div class="info">
              <span class="title">{{
                fav.activity?.title || "ไม่มีชื่อกิจกรรม"
              }}</span>
              <span class="read-action-text">คลิกเพื่ออ่านกิจกรรม</span>
            </div>
            <i class="fa-solid fa-chevron-right arrow-icon"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
